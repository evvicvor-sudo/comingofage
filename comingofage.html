<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coming of Age - Interactive Vocabulary Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            overflow-x: auto;
            border-bottom: 3px solid #667eea;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #555;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
        }

        .tab:hover {
            background: #e9ecef;
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            background: #e9ecef;
            height: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Task 1: Visual Matcher */
        .matcher-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .emoji-box {
            background: #f8f9fa;
            border: 3px dashed #dee2e6;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-height: 150px;
            transition: all 0.3s;
        }

        .emoji-box.drag-over {
            background: #e7f3ff;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .emoji-box.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .emoji-box.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .emoji {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .situation {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 15px;
        }

        .idiom-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            justify-content: center;
        }

        .idiom-chip {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: move;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .idiom-chip:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .idiom-chip.dragging {
            opacity: 0.5;
        }

        .dropped-idiom {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
            font-weight: 600;
        }

        /* Task 2: Story Sequencing */
        .story-cards {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .story-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            cursor: move;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .story-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .story-card.dragging {
            opacity: 0.5;
        }

        .card-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .card-text {
            flex-grow: 1;
            font-size: 1.1em;
        }

        .idiom-select {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            min-width: 200px;
        }

        /* Task 3: Rephrasing */
        .rephrase-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .rephrase-item.revealed {
            background: #e7f3ff;
        }

        .original-sentence {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #333;
            line-height: 1.6;
        }

        .model-answer {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .model-answer.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 200px; }
        }

        .model-answer strong {
            color: #28a745;
        }

        /* Task 4: Synonym Clusters */
        .clusters-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .cluster-box {
            background: #f8f9fa;
            border: 3px dashed #dee2e6;
            border-radius: 15px;
            padding: 20px;
            min-height: 200px;
        }

        .cluster-box.drag-over {
            background: #e7f3ff;
            border-color: #667eea;
        }

        .cluster-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .cluster-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Task 5: Odd One Out */
        .odd-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .odd-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .odd-option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .odd-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .odd-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .odd-option.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .odd-option.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        /* Task 6: Causes & Effects */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .matching-column h3 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .matching-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .matching-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .matching-item.selected {
            background: #e7f3ff;
            border-color: #667eea;
        }

        .matching-item.matched {
            background: #d4edda;
            border-color: #28a745;
            opacity: 0.7;
        }

        .match-line {
            stroke: #667eea;
            stroke-width: 3;
            fill: none;
        }

        .matched-pairs {
            margin-top: 30px;
        }

        .matched-pair {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .feedback-icon {
            font-size: 1.5em;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .tab {
                padding: 12px 15px;
                font-size: 0.9em;
            }

            .tab-content {
                padding: 20px;
            }

            .matcher-container,
            .clusters-container {
                grid-template-columns: 1fr;
            }

            .matching-container {
                grid-template-columns: 1fr;
            }

            .odd-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Coming of Age</h1>
            <p>Interactive Vocabulary Practice - B2 Level</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">1. Visual Matcher</button>
            <button class="tab" onclick="switchTab(1)">2. Story Sequencing</button>
            <button class="tab" onclick="switchTab(2)">3. Rephrasing</button>
            <button class="tab" onclick="switchTab(3)">4. Synonym Clusters</button>
            <button class="tab" onclick="switchTab(4)">5. Odd One Out</button>
            <button class="tab" onclick="switchTab(5)">6. Cause & Effect</button>
        </div>

        <!-- Task 1: Visual Vocabulary Matcher -->
        <div class="tab-content active" id="task1">
            <h2>Task 1: Visual Vocabulary Matcher üéØ</h2>
            <p style="margin-bottom: 20px; color: #666;">Drag the idioms to match them with the situations. You'll get instant feedback!</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress1" style="width: 0%;">0/15</div>
            </div>

            <div class="idiom-chips" id="idiomChips"></div>
            <div class="matcher-container" id="matcherContainer"></div>
            
            <button class="btn btn-secondary" onclick="resetTask1()">Reset</button>
        </div>

        <!-- Task 2: Story Sequencing -->
        <div class="tab-content" id="task2">
            <h2>Task 2: Anna's Story - Put Events in Order üìñ</h2>
            <p style="margin-bottom: 20px; color: #666;">Drag the cards to arrange them in the correct order, then select the appropriate idiom for each event.</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress2" style="width: 0%;">Not checked yet</div>
            </div>

            <div class="story-cards" id="storyCards"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="checkStoryOrder()">Check My Answer</button>
                <button class="btn btn-secondary" onclick="resetTask2()">Reset</button>
            </div>
        </div>

        <!-- Task 3: Rephrasing -->
        <div class="tab-content" id="task3">
            <h2>Task 3: Rephrase with Idioms ‚úçÔ∏è</h2>
            <p style="margin-bottom: 20px; color: #666;">Choose the correct idiom for each sentence, then see the model answer.</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress3" style="width: 0%;">0/10 checked</div>
            </div>

            <div id="rephraseContainer"></div>
            
            <button class="btn btn-secondary" onclick="resetTask3()">Reset</button>
        </div>

        <!-- Task 4: Synonym Clusters -->
        <div class="tab-content" id="task4">
            <h2>Task 4: Group by Meaning üéØ</h2>
            <p style="margin-bottom: 20px; color: #666;">Drag idioms into the correct category based on their meaning.</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress4" style="width: 0%;">0%</div>
            </div>

            <div class="idiom-chips" id="clusterChips"></div>
            <div class="clusters-container" id="clustersContainer"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="checkClusters()">Check My Grouping</button>
                <button class="btn btn-secondary" onclick="resetTask4()">Reset</button>
            </div>
        </div>

        <!-- Task 5: Odd One Out -->
        <div class="tab-content" id="task5">
            <h2>Task 5: Find the Odd One Out üîç</h2>
            <p style="margin-bottom: 20px; color: #666;">In each group, select the expression that doesn't belong with the others.</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress5" style="width: 0%;">0/7</div>
            </div>

            <div id="oddContainer"></div>
            
            <button class="btn btn-secondary" onclick="resetTask5()">Reset</button>
        </div>

        <!-- Task 6: Causes & Effects -->
        <div class="tab-content" id="task6">
            <h2>Task 6: Match Causes, Effects & Idioms üîó</h2>
            <p style="margin-bottom: 20px; color: #666;">First, drag causes to match with effects. Then select the appropriate idiom for each pair.</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress6" style="width: 0%;">0/8 pairs matched</div>
            </div>

            <div class="matching-container">
                <div class="matching-column">
                    <h3>Causes</h3>
                    <div id="causesContainer"></div>
                </div>
                <div class="matching-column">
                    <h3>Effects</h3>
                    <div id="effectsContainer"></div>
                </div>
            </div>

            <div class="matched-pairs" id="matchedPairs"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="resetTask6()">Reset</button>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                    contents[i].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[i].classList.remove('active');
                }
            });
        }

        // TASK 1: Visual Vocabulary Matcher
        const matcherData = [
            { emoji: "üéì", situation: "University graduation ceremony", idiom: "rite of passage" },
            { emoji: "üë∂‚û°Ô∏èüßë", situation: "Becoming legally an adult", idiom: "come of age" },
            { emoji: "ü™Ç", situation: "Trying skydiving for the first time", idiom: "step out of comfort zone" },
            { emoji: "üè†‚û°Ô∏è‚úàÔ∏è", situation: "Moving away from family home", idiom: "leaving the nest" },
            { emoji: "üí™üîÑ", situation: "Learning to recover after failures", idiom: "build resilience" },
            { emoji: "‚úÇÔ∏èüë∂", situation: "Becoming independent from parents", idiom: "cut the apron strings" },
            { emoji: "üíîüò¢", situation: "Very painful end of relationship", idiom: "heartbreaking breakup" },
            { emoji: "üåô‚û°Ô∏èüåû", situation: "Growing up very suddenly", idiom: "mature overnight" },
            { emoji: "üö∂‚û°Ô∏èüèÉ", situation: "Starting to feel confident and settled", idiom: "find one's feet" },
            { emoji: "‚è©", situation: "Accelerating your progress rapidly", idiom: "fast-track" },
            { emoji: "ü¶Öü™Ω", situation: "Exploring independence and freedom", idiom: "spread one's wings" },
            { emoji: "üîÑüìà", situation: "Critical moment that changes everything", idiom: "turning point" },
            { emoji: "üèÄ‚ÜóÔ∏è", situation: "Recovering quickly from setback", idiom: "bounce back" },
            { emoji: "üå±", situation: "Being inexperienced and naive", idiom: "wet behind the ears" },
            { emoji: "üéØüíº", situation: "Adapting successfully in real-world challenges", idiom: "real-world challenges" }
        ];

        let task1Score = 0;
        let task1Matches = {};

        function initTask1() {
            const container = document.getElementById('matcherContainer');
            const chipsContainer = document.getElementById('idiomChips');
            
            container.innerHTML = '';
            chipsContainer.innerHTML = '';
            
            // Create emoji boxes
            matcherData.forEach((item, index) => {
                const box = document.createElement('div');
                box.className = 'emoji-box';
                box.dataset.index = index;
                box.innerHTML = `
                    <span class="emoji">${item.emoji}</span>
                    <div class="situation">${item.situation}</div>
                    <div class="drop-zone" data-correct="${item.idiom}"></div>
                `;
                
                box.addEventListener('dragover', handleDragOver);
                box.addEventListener('drop', handleDrop);
                box.addEventListener('dragleave', handleDragLeave);
                
                container.appendChild(box);
            });
            
            // Create idiom chips (shuffled)
            const idioms = matcherData.map(item => item.idiom).sort(() => Math.random() - 0.5);
            idioms.forEach(idiom => {
                const chip = document.createElement('div');
                chip.className = 'idiom-chip';
                chip.draggable = true;
                chip.textContent = idiom;
                chip.dataset.idiom = idiom;
                
                chip.addEventListener('dragstart', handleDragStart);
                chip.addEventListener('dragend', handleDragEnd);
                
                chipsContainer.appendChild(chip);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.idiom);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const box = e.currentTarget;
            box.classList.remove('drag-over');
            
            const dropZone = box.querySelector('.drop-zone');
            if (dropZone.children.length > 0) return; // Already has an idiom
            
            const idiom = e.dataTransfer.getData('text/plain');
            const correctIdiom = dropZone.dataset.correct;
            
            const droppedElement = document.createElement('div');
            droppedElement.className = 'dropped-idiom';
            droppedElement.textContent = idiom;
            dropZone.appendChild(droppedElement);
            
            // Instant feedback
            if (idiom === correctIdiom) {
                box.classList.add('correct');
                droppedElement.innerHTML += ' <span class="feedback-icon">‚úÖ</span>';
                task1Score++;
                
                // Remove chip from pool
                const chip = document.querySelector(`.idiom-chip[data-idiom="${idiom}"]`);
                if (chip) chip.remove();
            } else {
                box.classList.add('incorrect');
                droppedElement.innerHTML += ' <span class="feedback-icon">‚ùå</span>';
                
                // Allow retry - remove after 1 second
                setTimeout(() => {
                    dropZone.innerHTML = '';
                    box.classList.remove('incorrect');
                }, 1000);
            }
            
            updateProgress1();
        }

        function updateProgress1() {
            const progress = document.getElementById('progress1');
            const percentage = (task1Score / matcherData.length) * 100;
            progress.style.width = percentage + '%';
            progress.textContent = `${task1Score}/${matcherData.length}`;
        }

        function resetTask1() {
            task1Score = 0;
            task1Matches = {};
            document.querySelectorAll('.emoji-box').forEach(box => {
                box.classList.remove('correct', 'incorrect');
            });
            initTask1();
            updateProgress1();
        }

        // TASK 2: Story Sequencing
        const storyData = [
            { text: "Anna lived with her parents until she was 25 years old", idiom: "cut the apron strings", order: 1 },
            { text: "One day, she decided it was time to move to London", idiom: "step out of comfort zone", order: 2 },
            { text: "She packed her bags and moved to London completely alone", idiom: "leaving the nest", order: 3 },
            { text: "The first month in London was scary and very confusing", idiom: "find one's feet", order: 4 },
            { text: "After six months, she started feeling confident and happy", idiom: "spread one's wings", order: 5 },
            { text: "Then she got her first job rejection, which was devastating", idiom: "real-world challenges", order: 6 },
            { text: "She learned to be stronger and not give up easily", idiom: "build resilience", order: 7 },
            { text: "Anna started dating someone new and fell deeply in love", idiom: "rite of passage", order: 8 },
            { text: "Unfortunately, they had a very painful breakup after one year", idiom: "heartbreaking breakup", order: 9 },
            { text: "Today, Anna is thriving independently and loving her life", idiom: "come of age", order: 10 }
        ];

        let currentStoryOrder = [];

        function initTask2() {
            const container = document.getElementById('storyCards');
            container.innerHTML = '';
            
            // Shuffle the cards
            const shuffled = [...storyData].sort(() => Math.random() - 0.5);
            currentStoryOrder = shuffled;
            
            const allIdioms = [
                "come of age", "step out of comfort zone", "real-world challenges", 
                "leaving the nest", "build resilience", "cut the apron strings",
                "heartbreaking breakup", "rite of passage", "find one's feet",
                "spread one's wings"
            ];
            
            shuffled.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'story-card';
                card.draggable = true;
                card.dataset.originalOrder = item.order;
                card.innerHTML = `
                    <div class="card-number">${index + 1}</div>
                    <div class="card-text">${item.text}</div>
                    <select class="idiom-select" data-correct="${item.idiom}">
                        <option value="">Choose idiom...</option>
                        ${allIdioms.map(idiom => `<option value="${idiom}">${idiom}</option>`).join('')}
                    </select>
                `;
                
                card.addEventListener('dragstart', cardDragStart);
                card.addEventListener('dragover', cardDragOver);
                card.addEventListener('drop', cardDrop);
                card.addEventListener('dragend', cardDragEnd);
                
                container.appendChild(card);
            });
        }

        function cardDragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.currentTarget.innerHTML);
            e.currentTarget.classList.add('dragging');
        }

        function cardDragOver(e) {
            e.preventDefault();
            const dragging = document.querySelector('.story-card.dragging');
            const afterElement = getDragAfterElement(e.currentTarget.parentElement, e.clientY);
            
            if (afterElement == null) {
                e.currentTarget.parentElement.appendChild(dragging);
            } else {
                e.currentTarget.parentElement.insertBefore(dragging, afterElement);
            }
        }

        function cardDrop(e) {
            e.preventDefault();
        }

        function cardDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.story-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function checkStoryOrder() {
            const cards = document.querySelectorAll('.story-card');
            let orderCorrect = true;
            let idiomsCorrect = 0;
            
            cards.forEach((card, index) => {
                const originalOrder = parseInt(card.dataset.originalOrder);
                const select = card.querySelector('.idiom-select');
                const correctIdiom = select.dataset.correct;
                const selectedIdiom = select.value;
                
                // Check order
                if (originalOrder !== index + 1) {
                    orderCorrect = false;
                }
                
                // Check idiom selection
                if (selectedIdiom === correctIdiom) {
                    select.style.borderColor = '#28a745';
                    select.style.background = '#d4edda';
                    idiomsCorrect++;
                } else if (selectedIdiom !== '') {
                    select.style.borderColor = '#dc3545';
                    select.style.background = '#f8d7da';
                }
                
                // Update card number color
                const cardNumber = card.querySelector('.card-number');
                if (originalOrder === index + 1) {
                    cardNumber.style.background = '#28a745';
                } else {
                    cardNumber.style.background = '#dc3545';
                }
            });
            
            const progress = document.getElementById('progress2');
            if (orderCorrect && idiomsCorrect === 10) {
                progress.style.width = '100%';
                progress.textContent = 'Perfect! ‚úÖ';
                progress.parentElement.style.background = '#d4edda';
            } else {
                const percentage = (idiomsCorrect / 10) * 100;
                progress.style.width = percentage + '%';
                progress.textContent = `Order: ${orderCorrect ? '‚úÖ' : '‚ùå'} | Idioms: ${idiomsCorrect}/10`;
            }
        }

        function resetTask2() {
            initTask2();
            const progress = document.getElementById('progress2');
            progress.style.width = '0%';
            progress.textContent = 'Not checked yet';
            progress.parentElement.style.background = '#e9ecef';
        }

        // TASK 3: Rephrasing
        const rephraseData = [
            {
                original: "Mark was 17 when his father died. Suddenly he had to pay bills, cook, and support his younger sister. Within months, he seemed like a different person.",
                idiom: "mature overnight",
                model: "Mark had to mature overnight when his father died at 17, forcing him to take on adult responsibilities."
            },
            {
                original: "Sarah got her university degree and moved to a new city. She had to learn to do everything by herself without her parents' help.",
                idiom: "cut the apron strings",
                model: "After getting her degree, Sarah finally cut the apron strings and started living independently in a new city."
            },
            {
                original: "The first few weeks at my new job were terrible. I didn't know anyone and felt lost. But now I'm doing much better.",
                idiom: "find one's feet",
                model: "It took me a few weeks to find my feet at my new job, but now I'm settling in well."
            },
            {
                original: "Jake decided to quit his safe job and start his own business. It was scary but exciting to try something completely new.",
                idiom: "step out of comfort zone",
                model: "Jake stepped out of his comfort zone by leaving his secure job to launch his own business."
            },
            {
                original: "After losing the championship, the team trained harder than ever. Next year they came back and won everything.",
                idiom: "bounce back",
                model: "The team showed incredible resilience, bouncing back from their championship loss to win everything the following year."
            },
            {
                original: "Getting my first apartment was a huge moment in my life. I finally felt like a real adult.",
                idiom: "rite of passage",
                model: "Getting my first apartment was a true rite of passage that made me feel like a genuine adult."
            },
            {
                original: "Emma's relationship ended badly and it hurt so much she thought she'd never love again.",
                idiom: "heartbreaking breakup",
                model: "Emma went through a heartbreaking breakup that left her questioning whether she could ever love again."
            },
            {
                original: "The new intern is only 20 and has never worked before. He doesn't understand how offices work yet.",
                idiom: "wet behind the ears",
                model: "The new intern is still wet behind the ears, having never experienced a professional work environment before."
            },
            {
                original: "After years of struggling, losing my job became the moment when everything changed for the better.",
                idiom: "turning point",
                model: "Losing my job became an unexpected turning point that ultimately led to positive changes in my life."
            },
            {
                original: "Living alone teaches you to deal with paying rent, fixing problems, and making hard decisions by yourself.",
                idiom: "real-world challenges",
                model: "Living independently forces you to face real-world challenges like managing finances and solving problems on your own."
            }
        ];

        function initTask3() {
            const container = document.getElementById('rephraseContainer');
            container.innerHTML = '';
            
            const allIdioms = [
                "come of age", "step out of comfort zone", "real-world challenges", 
                "leaving the nest", "build resilience", "cut the apron strings",
                "heartbreaking breakup", "rite of passage", "mature overnight",
                "find one's feet", "spread one's wings", "turning point",
                "bounce back", "wet behind the ears", "fast-track"
            ];
            
            rephraseData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'rephrase-item';
                div.innerHTML = `
                    <div class="original-sentence"><strong>Sentence ${index + 1}:</strong> ${item.original}</div>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <select class="idiom-select" data-correct="${item.idiom}" id="rephrase${index}">
                            <option value="">Choose the idiom...</option>
                            ${allIdioms.map(idiom => `<option value="${idiom}">${idiom}</option>`).join('')}
                        </select>
                        <button class="btn btn-primary" onclick="checkRephrase(${index})">Check & Show Model</button>
                    </div>
                    <div class="model-answer" id="model${index}">
                        <strong>Model Answer:</strong> ${item.model}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function checkRephrase(index) {
            const select = document.getElementById(`rephrase${index}`);
            const model = document.getElementById(`model${index}`);
            const correct = select.dataset.correct;
            const selected = select.value;
            
            if (selected === '') {
                alert('Please select an idiom first!');
                return;
            }
            
            if (selected === correct) {
                select.style.borderColor = '#28a745';
                select.style.background = '#d4edda';
            } else {
                select.style.borderColor = '#dc3545';
                select.style.background = '#f8d7da';
            }
            
            model.classList.add('show');
            select.closest('.rephrase-item').classList.add('revealed');
            
            updateProgress3();
        }

        function updateProgress3() {
            const revealed = document.querySelectorAll('.model-answer.show').length;
            const progress = document.getElementById('progress3');
            const percentage = (revealed / rephraseData.length) * 100;
            progress.style.width = percentage + '%';
            progress.textContent = `${revealed}/${rephraseData.length} checked`;
        }

        function resetTask3() {
            initTask3();
            const progress = document.getElementById('progress3');
            progress.style.width = '0%';
            progress.textContent = '0/10 checked';
        }

        // TASK 4: Synonym Clusters
        const clusterData = {
            "Independence & Freedom": ["leaving the nest", "cut the apron strings", "spread one's wings", "step out of comfort zone"],
            "Recovery & Resilience": ["bounce back", "build resilience", "turning point"],
            "Growth & Maturity": ["come of age", "mature overnight", "find one's feet", "rite of passage"],
            "Challenges & Difficulties": ["real-world challenges", "heartbreaking breakup"],
            "Inexperience": ["wet behind the ears"]
        };

        let clusterAssignments = {};

        function initTask4() {
            const chipsContainer = document.getElementById('clusterChips');
            const clustersContainer = document.getElementById('clustersContainer');
            
            chipsContainer.innerHTML = '';
            clustersContainer.innerHTML = '';
            clusterAssignments = {};
            
            // Create all idiom chips (shuffled)
            const allIdioms = Object.values(clusterData).flat().sort(() => Math.random() - 0.5);
            allIdioms.forEach(idiom => {
                const chip = document.createElement('div');
                chip.className = 'idiom-chip';
                chip.draggable = true;
                chip.textContent = idiom;
                chip.dataset.idiom = idiom;
                
                chip.addEventListener('dragstart', handleDragStart);
                chip.addEventListener('dragend', handleDragEnd);
                
                chipsContainer.appendChild(chip);
            });
            
            // Create cluster boxes
            Object.keys(clusterData).forEach(category => {
                const box = document.createElement('div');
                box.className = 'cluster-box';
                box.dataset.category = category;
                box.innerHTML = `
                    <div class="cluster-title">${category}</div>
                    <div class="cluster-items"></div>
                `;
                
                box.addEventListener('dragover', clusterDragOver);
                box.addEventListener('drop', clusterDrop);
                box.addEventListener('dragleave', handleDragLeave);
                
                clustersContainer.appendChild(box);
            });
        }

        function clusterDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        function clusterDrop(e) {
            e.preventDefault();
            const box = e.currentTarget;
            box.classList.remove('drag-over');
            
            const idiom = e.dataTransfer.getData('text/plain');
            const category = box.dataset.category;
            const itemsContainer = box.querySelector('.cluster-items');
            
            // Check if already in this box
            if (clusterAssignments[idiom] === category) return;
            
            // Remove from previous location
            if (clusterAssignments[idiom]) {
                const prevBox = document.querySelector(`[data-category="${clusterAssignments[idiom]}"]`);
                const prevChip = prevBox.querySelector(`[data-idiom="${idiom}"]`);
                if (prevChip) prevChip.remove();
            }
            
            // Add to new location
            const chip = document.createElement('div');
            chip.className = 'idiom-chip';
            chip.draggable = true;
            chip.textContent = idiom;
            chip.dataset.idiom = idiom;
            chip.style.fontSize = '0.9em';
            chip.style.margin = '5px 0';
            
            chip.addEventListener('dragstart', handleDragStart);
            chip.addEventListener('dragend', handleDragEnd);
            
            itemsContainer.appendChild(chip);
            clusterAssignments[idiom] = category;
            
            // Remove from chips pool
            const poolChip = document.querySelector(`#clusterChips [data-idiom="${idiom}"]`);
            if (poolChip) poolChip.remove();
        }

        function checkClusters() {
            let correct = 0;
            let total = 0;
            
            Object.keys(clusterData).forEach(category => {
                const correctIdioms = clusterData[category];
                const box = document.querySelector(`[data-category="${category}"]`);
                const itemsContainer = box.querySelector('.cluster-items');
                const chips = itemsContainer.querySelectorAll('.idiom-chip');
                
                chips.forEach(chip => {
                    total++;
                    const idiom = chip.dataset.idiom;
                    if (correctIdioms.includes(idiom)) {
                        chip.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                        correct++;
                    } else {
                        chip.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
                    }
                });
            });
            
            const progress = document.getElementById('progress4');
            const percentage = (correct / total) * 100;
            progress.style.width = percentage + '%';
            progress.textContent = `${correct}/${total} correct (${Math.round(percentage)}%)`;
            
            if (percentage === 100) {
                progress.parentElement.style.background = '#d4edda';
            }
        }

        function resetTask4() {
            initTask4();
            const progress = document.getElementById('progress4');
            progress.style.width = '0%';
            progress.textContent = '0%';
            progress.parentElement.style.background = '#e9ecef';
        }

        // TASK 5: Odd One Out
        const oddData = [
            {
                options: ["mature overnight", "find one's feet", "heartbreaking breakup", "come of age"],
                correct: "heartbreaking breakup",
                reason: "It's an event, others are processes"
            },
            {
                options: ["leaving the nest", "cut the apron strings", "spread one's wings", "bounce back"],
                correct: "bounce back",
                reason: "It's about recovery, others are about independence"
            },
            {
                options: ["build resilience", "real-world challenges", "turning point", "step out of comfort zone"],
                correct: "build resilience",
                reason: "It's an ongoing process, others are specific moments/situations"
            },
            {
                options: ["wet behind the ears", "mature overnight", "come of age", "rite of passage"],
                correct: "wet behind the ears",
                reason: "It describes lack of maturity, others describe gaining maturity"
            },
            {
                options: ["fast-track", "bounce back", "turning point", "heartbreaking breakup"],
                correct: "heartbreaking breakup",
                reason: "It's negative, others can be positive changes"
            },
            {
                options: ["leaving the nest", "cut the apron strings", "find one's feet", "spread one's wings"],
                correct: "find one's feet",
                reason: "It's about adapting to change, others are about initiating independence"
            },
            {
                options: ["build resilience", "bounce back", "mature overnight", "turning point"],
                correct: "turning point",
                reason: "It's a specific moment, others are about developing strength"
            }
        ];

        let oddScore = 0;

        function initTask5() {
            const container = document.getElementById('oddContainer');
            container.innerHTML = '';
            oddScore = 0;
            
            oddData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'odd-question';
                div.innerHTML = `
                    <h3>Question ${index + 1}</h3>
                    <div class="odd-options" id="oddOptions${index}">
                        ${item.options.map(option => `
                            <div class="odd-option" onclick="selectOdd(${index}, '${option}', '${item.correct}')">${option}</div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
            
            updateProgress5();
        }

        function selectOdd(questionIndex, selected, correct) {
            const optionsContainer = document.getElementById(`oddOptions${questionIndex}`);
            const options = optionsContainer.querySelectorAll('.odd-option');
            
            // Check if already answered
            if (options[0].classList.contains('correct') || options[0].classList.contains('incorrect')) {
                return;
            }
            
            options.forEach(option => {
                if (option.textContent === selected) {
                    if (selected === correct) {
                        option.classList.add('correct');
                        option.innerHTML += ' ‚úÖ';
                        oddScore++;
                    } else {
                        option.classList.add('incorrect');
                        option.innerHTML += ' ‚ùå';
                    }
                } else if (option.textContent === correct && selected !== correct) {
                    option.classList.add('correct');
                    option.innerHTML += ' ‚úÖ';
                }
            });
            
            updateProgress5();
        }

        function updateProgress5() {
            const progress = document.getElementById('progress5');
            const percentage = (oddScore / oddData.length) * 100;
            progress.style.width = percentage + '%';
            progress.textContent = `${oddScore}/${oddData.length}`;
            
            if (oddScore === oddData.length) {
                progress.parentElement.style.background = '#d4edda';
            }
        }

        function resetTask5() {
            initTask5();
        }

        // TASK 6: Causes & Effects
        const causeEffectData = [
            {
                cause: "Failed university entrance exam",
                effect: "Studied harder and got into better school next year",
                idiom: "turning point"
            },
            {
                cause: "Lost job during economic crisis",
                effect: "Started own successful business",
                idiom: "bounce back"
            },
            {
                cause: "Parents were overprotective for 22 years",
                effect: "Finally moved out and became independent",
                idiom: "cut the apron strings"
            },
            {
                cause: "Took gap year to travel solo around Asia",
                effect: "Gained confidence and life experience",
                idiom: "spread one's wings"
            },
            {
                cause: "First serious relationship ended badly",
                effect: "Learned what to look for in future partners",
                idiom: "heartbreaking breakup"
            },
            {
                cause: "Joined competitive sports team",
                effect: "Learned to handle pressure and failure",
                idiom: "build resilience"
            },
            {
                cause: "Moved to new country without speaking language",
                effect: "Forced to adapt quickly and become more mature",
                idiom: "mature overnight"
            },
            {
                cause: "Got first apartment and full-time job",
                effect: "Started feeling like real adult",
                idiom: "come of age"
            }
        ];

        let selectedCause = null;
        let matchedPairs = [];

        function initTask6() {
            const causesContainer = document.getElementById('causesContainer');
            const effectsContainer = document.getElementById('effectsContainer');
            const matchedPairsContainer = document.getElementById('matchedPairs');
            
            causesContainer.innerHTML = '';
            effectsContainer.innerHTML = '';
            matchedPairsContainer.innerHTML = '';
            selectedCause = null;
            matchedPairs = [];
            
            // Shuffle causes and effects separately
            const shuffledCauses = [...causeEffectData].sort(() => Math.random() - 0.5);
            const shuffledEffects = [...causeEffectData].sort(() => Math.random() - 0.5);
            
            shuffledCauses.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'matching-item';
                div.dataset.index = index;
                div.dataset.cause = item.cause;
                div.textContent = item.cause;
                div.onclick = () => selectCause(div);
                causesContainer.appendChild(div);
            });
            
            shuffledEffects.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'matching-item';
                div.dataset.effect = item.effect;
                div.dataset.correctCause = item.cause;
                div.dataset.correctIdiom = item.idiom;
                div.textContent = item.effect;
                div.onclick = () => selectEffect(div);
                effectsContainer.appendChild(div);
            });
            
            updateProgress6();
        }

        function selectCause(element) {
            // Deselect previous
            document.querySelectorAll('#causesContainer .matching-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            if (element.classList.contains('matched')) return;
            
            element.classList.add('selected');
            selectedCause = element;
        }

        function selectEffect(element) {
            if (!selectedCause || element.classList.contains('matched')) return;
            
            const causeText = selectedCause.dataset.cause;
            const effectText = element.dataset.effect;
            const correctCause = element.dataset.correctCause;
            const correctIdiom = element.dataset.correctIdiom;
            
            // Check if match is correct
            if (causeText === correctCause) {
                selectedCause.classList.add('matched');
                element.classList.add('matched');
                
                // Create matched pair display with idiom selection
                createMatchedPair(causeText, effectText, correctIdiom);
                
                selectedCause = null;
                updateProgress6();
            } else {
                // Shake animation for wrong match
                element.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    element.style.animation = '';
                }, 500);
            }
        }

        function createMatchedPair(cause, effect, correctIdiom) {
            const container = document.getElementById('matchedPairs');
            const pairDiv = document.createElement('div');
            pairDiv.className = 'matched-pair';
            
            const allIdioms = [
                "come of age", "step out of comfort zone", "build resilience", 
                "cut the apron strings", "heartbreaking breakup", "turning point",
                "mature overnight", "spread one's wings", "bounce back"
            ];
            
            pairDiv.innerHTML = `
                <div style="margin-bottom: 10px;"><strong>Cause:</strong> ${cause}</div>
                <div style="margin-bottom: 15px;"><strong>Effect:</strong> ${effect}</div>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <strong>Choose idiom:</strong>
                    <select class="idiom-select" data-correct="${correctIdiom}" onchange="checkPairIdiom(this)">
                        <option value="">Select...</option>
                        ${allIdioms.map(idiom => `<option value="${idiom}">${idiom}</option>`).join('')}
                    </select>
                </div>
            `;
            
            container.appendChild(pairDiv);
            matchedPairs.push({cause, effect, correctIdiom});
        }

        function checkPairIdiom(select) {
            const correct = select.dataset.correct;
            const selected = select.value;
            
            if (selected === correct) {
                select.style.borderColor = '#28a745';
                select.style.background = '#d4edda';
            } else if (selected !== '') {
                select.style.borderColor = '#dc3545';
                select.style.background = '#f8d7da';
            }
        }

        function updateProgress6() {
            const progress = document.getElementById('progress6');
            const matched = matchedPairs.length;
            const percentage = (matched / causeEffectData.length) * 100;
            progress.style.width = percentage + '%';
            progress.textContent = `${matched}/${causeEffectData.length} pairs matched`;
            
            if (matched === causeEffectData.length) {
                progress.parentElement.style.background = '#d4edda';
            }
        }

        function resetTask6() {
            initTask6();
        }

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);

        // Initialize all tasks on page load
        window.onload = function() {
            initTask1();
            initTask2();
            initTask3();
            initTask4();
            initTask5();
            initTask6();
        };
    </script>
</body>
</html>